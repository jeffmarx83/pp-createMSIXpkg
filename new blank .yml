####
#With VSBuild you can build and sign the application in one step.
- task: VSBuild@1
  inputs:
    solution: '$(Agent.BuildDirectory)\s\$(folderRepository)\UWP.Test\UWP.Test.csproj'
    platform: $(buildPlatform)
    configuration: $(buildConfiguration)
    msbuildArguments: '/p:AppxBundlePlatforms="$(buildPlatform)" /p:AppxPackageDir="$(appxPackageDir)" /p:AppxBundle=Always /p:UapAppxPackageBuildMode=StoreUpload'
  displayName: 'Building UWP Test App'
####
#This step run the tests.
- task: VSTest@2
  inputs:
    platform: $(buildPlatform)
    testSelector: 'testAssemblies'
    testAssemblyVer2: |
      **\Release\UWP.Test.build.appxrecipe
      !**\*TestAdapter.dll
      !**\obj\**
    searchFolder: '$(System.DefaultWorkingDirectory)'
    codeCoverageEnabled: true
    publishRunAttachments: true
  displayName: 'Running UWP Tests'
####
#This step publish the test results.
- task: PublishTestResults@2
  inputs:
    testResultsFormat: 'VSTest'
    testResultsFiles: '**/TEST-*.trx'
  displayName: 'Publishing UWP tests results'